extends layout

mixin checkBox(source, value)
  - var inputId = source
  - var inputValue = value
  - var label = source
  .checkbox
    label
      if inputValue
        input(name=inputId id=inputId class='tag' checked='checked' type='checkbox')
        | !{label}
      else
        input(name=inputId id=inputId class='tag' type='checkbox')
        | !{label}

mixin apiCategories(apiTags, params)
    .panel.panel-default
      .panel-body.wicked-api-body
        form(role='form' action='/apis' method='GET')
          .form-group
            b API Categories
            input(name='filter' id='filter' value='on' type='hidden')
            div(style='height: 250px; overflow-y: scroll; overflow-x: hidden;')
              each tag, i in apiTags
                +checkBox(tag, params[tag])
            button(type='submit' style='float: left; margin-top: 10px;' class='filter-button' 
            br
            onclick='checkCategoryFilter()').btn.btn-primary Filter
            | &nbsp;
            a(class="btn btn-primary clear-button" href="/apis" style='float: left; margin: 10px;' role="button") Clear


mixin apiDef(anApi)
    .col-md-4
      .panel.panel-default
        .panel-body.wicked-api-body
          if glob.views.apis.showApiIcon
            img(src='/images/api-icon.png')
          if anApi.auth == 'oauth2'
            a(href='/help/apis' target='_blank')
              img(src='/images/oauth2-icon-32.png' align='right' title='Secured with OAuth2 Access')
          else if anApi.auth == 'none'
          else
            a(href='/help/apis' target='_blank')
              img(src='/images/key-icon-32.png' align='right' title='Secured with API Key Access')
          a(href=`/apis/${anApi.id}`)
            h4= anApi.name
          if anApi.deprecated
            p(style='color:red;') <b>Deprecated</b>
          p!= anApi.desc
            p
              a(class="btn btn-default" href=`/apis/${anApi.id}` role="button") Information &raquo;
          if anApi.bundle && anApi.id !== 'cortellis-api-collection'
            p
              a(href='/help/bundles')
                span.label.label-info= anApi.bundle

block scripts
  script(type='text/javascript').
    function checkCategoryFilter() {
      if($(".tag:checked").length <= 0){
        $("input[id='filter']").remove();
      }
    }

block content
    .jumbotron.wicked-api-title
      .container.wicked-title-container
        h1= title

        p= glob.views.apis.titleTagline

    .container.wicked-container
      if desc
        p!= desc
      p &nbsp;
      div(class="row")
        - var length = apilist.length
        - var apiClass = "col-md-12"
        - var filteredApiList = apilist 
        if (apiTags.length > 0)
          div(class="col-md-3")
            +apiCategories(apiTags, params, params.searchQuery)
          - apiClass = "col-md-9"
        if (filteredApiList.length === 0)
          div.apiClass(style='text-align: center;')
            img(src='/content/images/image.png', style='margin-top: 5px; margin-right: 5px;')
            p(style='margin-top: 5px; font-size: 40px; font-weight: bold;') No APIs Found
        div(class=apiClass)
          if authUser && (authUser.admin === true && authUser.superadmin === false)
            filteredApiList = apilist.filter(api => api.id !== 'portal-api')
            each api, i in filteredApiList
              if (i % 3 == 0)
                div(class="row")
                  +apiDef(filteredApiList[i])
                  if (i+1) < filteredApiList.length
                    +apiDef(filteredApiList[i+1])
                  if (i+2) < filteredApiList.length
                    +apiDef(filteredApiList[i+2])
          //- //Hideing All api listed in glob.cortellisUi.cortelliesApi.InvestigationalApi For {Admin}{superadmin}{appover}{publicUser}{authUser} requiredGroup which empty
          else if authUser && (authUser.admin !== true && authUser.authenticated_scope.includes('wicked:')) || authUser !== true
              - const apiDataString = JSON.stringify(glob.cortellisUi.cortelliesApi.InvestigationalApi);
              - const apiData = JSON.parse(apiDataString);
              - const apiIDs = apiData.map(obj => Object.values(obj));
              - const filteredApiList = apilist.filter(api => !apiIDs.some(item => item.includes(api.id)));
              each api, i in filteredApiList
                if i % 3 === 0
                  div(class="row")
                    +apiDef(filteredApiList[i])
                    if i + 1 < filteredApiList.length
                      +apiDef(filteredApiList[i + 1])
                    if i + 2 < filteredApiList.length
                      +apiDef(filteredApiList[i + 2])
          else 
            each api, i in apilist
              if (i % 3 == 0)
                div(class="row")
                  +apiDef(apilist[i])
                  if (i+1) < length
                    +apiDef(apilist[i+1])
                  if (i+2) < length
                    +apiDef(apilist[i+2])
